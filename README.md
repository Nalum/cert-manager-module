# cert-manager

[![cert-manager](https://img.shields.io/badge/cert--manager-v1.13.2-00bfff)](https://cert-manager.io)
[![timoni.sh](https://img.shields.io/badge/timoni.sh-v0.18.0-7e56c2)](https://timoni.sh)
[![kubernetes](https://img.shields.io/badge/kubernetes-v1.29.0-326CE5?logo=kubernetes&logoColor=white)](https://kubernetes.io)
[![License](https://img.shields.io/github/license/nalum/cert-manager-module)](https://github.com/nalum/cert-manager-module/blob/main/LICENSE)
[![Release](https://img.shields.io/github/v/release/nalum/cert-manager-module)](https://github.com/nalum/cert-manager-module/releases)

A [timoni.sh](http://timoni.sh) module for deploying cert-manager to Kubernetes clusters.

[![Timoni cert-manager](https://asciinema.org/a/631238.svg)](https://asciinema.org/a/631238)

## Install

To create an instance using the default values:

```shell
timoni -n cert-manager apply cert-manager oci://ghcr.io/nalum/timoni/modules/cert-manager
```

To change the [default configuration](#configuration),
create one or more `values.cue` files and apply them to the instance.

For example, create a file `my-values.cue` with the following content:

```cue
values: {
    highAvailability: enabled: true

    controller: {
        config: logging: format: "json"
        podDisruptionBudget: minAvailable: 2

        monitoring: {
            enabled: true
        }

        image: {
            tag:    "v1.13.0"
            digest: "sha256:2547fde4e736101abf33f8c2503f12aa3a0b42614d3d64cfecf2835c0ee81c10"
        }
    }

    webhook: {
        podDisruptionBudget: minAvailable: 3
    }

    test: enabled: false
}
```

And apply the values with:

```shell
timoni -n cert-manager apply cert-manager oci://ghcr.io/nalum/timoni/modules/cert-manager \
  --values ./my-values.cue
```

## Uninstall

To uninstall an instance and delete all its Kubernetes resources:

```shell
timoni -n cert-manager delete cert-manager
```

| Testing | Table | Should | Stay |
|---------|-------|--------|------|
| Testing | Table | Should | Stay |
| Testing | Table | Should | Stay |
| Testing | Table | Should | Stay |
| Testing | Table | Should | Stay |

## Configuration

| KEY                                                                          | TYPE           | DEFAULT                                                                                                                                                                                                                                                                                                                                                         | DESCRIPTION                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------------------------------------------|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `logLevel:`                                                                  | `int`          | `2`                                                                                                                                                                                                                                                                                                                                                             | Logging verbosity                                                                                                                                                                                                                                                                                                                                                                                                               |
| `rbac: enabled:`                                                             | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Create the roles and bindings for cert-manager                                                                                                                                                                                                                                                                                                                                                                                  |
| `rbac: aggregateClusterRoles:`                                               | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Aggregate ClusterRoles to Kubernetes default user-facing roles. Ref: https://kubernetes.io/docs/reference/access-authn-authz/rbac/#user-facing-roles                                                                                                                                                                                                                                                                            |
| `podSecurityAdmission: mode:`                                                | `string`       | `"enforce"`                                                                                                                                                                                                                                                                                                                                                     | Set the PodSecurity admission controller mode for the namespace                                                                                                                                                                                                                                                                                                                                                                 |
| `podSecurityAdmission: level:`                                               | `string`       | `"restricted"`                                                                                                                                                                                                                                                                                                                                                  | Set the PodSecurity admission controller level for the namespace                                                                                                                                                                                                                                                                                                                                                                |
| `highAvailability: enabled:`                                                 | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | Enable high availability features                                                                                                                                                                                                                                                                                                                                                                                               |
| `highAvailability: controllerReplicas:`                                      | `int`          | `2`                                                                                                                                                                                                                                                                                                                                                             | Number of replicas of the cert-manager controller to run                                                                                                                                                                                                                                                                                                                                                                        |
| `highAvailability: webhookReplicas:`                                         | `int`          | `3`                                                                                                                                                                                                                                                                                                                                                             | Number of replicas of the cert-manager webhook to run                                                                                                                                                                                                                                                                                                                                                                           |
| `highAvailability: caInjectorReplicas:`                                      | `int`          | `2`                                                                                                                                                                                                                                                                                                                                                             | Number of replicas of the cert-manager caInjector to run                                                                                                                                                                                                                                                                                                                                                                        |
| `leaderElection: namespace:`                                                 | `string`       | `"kube-system"`                                                                                                                                                                                                                                                                                                                                                 | Override the namespace used for the leader election lease                                                                                                                                                                                                                                                                                                                                                                       |
| `controller: maxConcurrentChallenges:`                                       | `int`          | `60`                                                                                                                                                                                                                                                                                                                                                            | The maximum number of challenges that can be scheduled as 'processing' at once                                                                                                                                                                                                                                                                                                                                                  |
| `controller: podDNSPolicy:`                                                  | `string`       | `"ClusterFirst"`                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: monitoring: enabled:`                                           | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | Enable Prometheus monitoring                                                                                                                                                                                                                                                                                                                                                                                                    |
| `controller: monitoring: serviceMonitor: enabled:`                           | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | Enable Prometheus ServiceMonitor monitoring instead of the prometheus shim                                                                                                                                                                                                                                                                                                                                                      |
| `controller: monitoring: serviceMonitor: prometheusInstance:`                | `string`       | `"default"`                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: monitoring: serviceMonitor: targetPort:`                        | `(int|string)` | `"http-metrics"`                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: monitoring: serviceMonitor: path:`                              | `string`       | `"/metrics"`                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: monitoring: serviceMonitor: interval:`                          | `string`       | `"60s"`                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: monitoring: serviceMonitor: scrapeTimeout:`                     | `string`       | `"30s"`                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: monitoring: serviceMonitor: honorLabels:`                       | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: automountServiceAccountToken:`                                  | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `controller: containerSecurityContext: capabilities: drop:`                  | `list`         | `["ALL"]`                                                                                                                                                                                                                                                                                                                                                       | Removed capabilities                                                                                                                                                                                                                                                                                                                                                                                                            |
| `controller: containerSecurityContext: runAsNonRoot:`                        | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Indicates that the container must run as a non-root user. If true, the Kubelet will validate the image at runtime to ensure that it does not run as UID 0 (root) and fail to start the container if it does. If unset or false, no such validation will be performed. May also be set in PodSecurityContext.  If set in both SecurityContext and PodSecurityContext, the value specified in SecurityContext takes precedence.   |
| `controller: containerSecurityContext: readOnlyRootFilesystem:`              | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Whether this container has a read-only root filesystem. Default is false. Note that this field cannot be set when spec.os.name is windows.                                                                                                                                                                                                                                                                                      |
| `controller: containerSecurityContext: allowPrivilegeEscalation:`            | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | AllowPrivilegeEscalation controls whether a process can gain more privileges than its parent process. This bool directly controls if the no_new_privs flag will be set on the container process. AllowPrivilegeEscalation is true always when the container is: 1) run as Privileged 2) has CAP_SYS_ADMIN Note that this field cannot be set when spec.os.name is windows.                                                      |
| `controller: enableServiceLinks:`                                            | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether information about services should be injected into pod's environment variables, matching the syntax of Docker links.                                                                                                                                                                                                                                                                                          |
| `controller: image: repository:`                                             | `string`       | `"quay.io/jetstack/cert-manager-controller"`                                                                                                                                                                                                                                                                                                                    | Repository is the address of a container registry repository. An image repository is made up of slash-separated name components, optionally prefixed by a registry hostname and port in the format [HOST[:PORT_NUMBER]/]PATH.                                                                                                                                                                                                   |
| `controller: image: tag:`                                                    | `string`       | `"v1.13.2"`                                                                                                                                                                                                                                                                                                                                                     | Tag identifies an image in the repository. A tag name may contain lowercase and uppercase characters, digits, underscores, periods and dashes. A tag name may not start with a period or a dash and may contain a maximum of 128 characters.                                                                                                                                                                                    |
| `controller: image: digest:`                                                 | `string`       | `"sha256:9c67cf8c92d8693f9b726bec79c2a84d2cebeb217af6947355601dec4acfa966"`                                                                                                                                                                                                                                                                                     | Digest uniquely and immutably identifies an image in the repository. Spec: https://github.com/opencontainers/image-spec/blob/main/descriptor.md#digests.                                                                                                                                                                                                                                                                        |
| `controller: image: pullPolicy:`                                             | `string`       | `"IfNotPresent"`                                                                                                                                                                                                                                                                                                                                                | PullPolicy defines the pull policy for the image. By default, it is set to IfNotPresent.                                                                                                                                                                                                                                                                                                                                        |
| `controller: podDisruptionBudget: enabled:`                                  | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: podDisruptionBudget: minAvailable:`                             | `(int|string)` | `1`                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: replicas:`                                                      | `int`          | `1`                                                                                                                                                                                                                                                                                                                                                             | is the number of desired replicas.                                                                                                                                                                                                                                                                                                                                                                                              |
| `controller: securityContext: runAsNonRoot:`                                 | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: securityContext: seccompProfile: type:`                         | `string`       | `"RuntimeDefault"`                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `controller: serviceAccount: automountServiceAccountToken:`                  | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `controller: service: type:`                                                 | `string`       | `"ClusterIP"`                                                                                                                                                                                                                                                                                                                                                   | is the type of the service.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `controller: volumeMounts:`                                                  | `list`         | `[{"mountPath": "/var/run/secrets/kubernetes.io/serviceaccount","name": "serviceaccount-token","readOnly":true}]`                                                                                                                                                                                                                                               | is the volume mounts for the container.                                                                                                                                                                                                                                                                                                                                                                                         |
| `controller: volumes:`                                                       | `list`         | `[{"name": "serviceaccount-token","projected":{"defaultMode":444,"sources":[{"serviceAccountToken":{"expirationSeconds":3607,"path": "token"}},{"configMap":{"name": "kube-root-ca.crt","items":[{"key": "ca.crt","path": "ca.crt"}]}},{"downwardAPI":{"items":[{"path": "namespace","fieldRef":{"apiVersion": "v1","fieldPath": "metadata.namespace"}}]}}]}}]` | is the volumes for the pod.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `webhook: hostNetwork:`                                                      | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | enalbes host networking for the webhook pod.                                                                                                                                                                                                                                                                                                                                                                                    |
| `webhook: securePort:`                                                       | `int`          | `10250`                                                                                                                                                                                                                                                                                                                                                         | set the port that the webhook should listen on for requests.                                                                                                                                                                                                                                                                                                                                                                    |
| `webhook: timeoutSeconds:`                                                   | `int`          | `10`                                                                                                                                                                                                                                                                                                                                                            | number of seconds to wait before timing out a request to the webhook.                                                                                                                                                                                                                                                                                                                                                           |
| `webhook: args:`                                                             | `list`         | `[]`                                                                                                                                                                                                                                                                                                                                                            | are the arguments to pass to the webhook pod.                                                                                                                                                                                                                                                                                                                                                                                   |
| `webhook: networkPolicy:`                                                    | `struct`       | `{"ingress":[{"from":[{"ipBlock":{"cidr": "0.0.0.0/0"}}]}],"egress":[{"ports":[{"port":80,"protocol": "TCP"},{"port":443,"protocol": "TCP"},{"port":53,"protocol": "TCP"},{"port":53,"protocol": "UDP"},{"port":6443,"protocol": "TCP"}],"to":[{"ipBlock":{"cidr": "0.0.0.0/0"}}]}]}`                                                                           | is a map of network policy rules to apply to the webhook pod.                                                                                                                                                                                                                                                                                                                                                                   |
| `webhook: automountServiceAccountToken:`                                     | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `webhook: containerSecurityContext: capabilities: drop:`                     | `list`         | `["ALL"]`                                                                                                                                                                                                                                                                                                                                                       | Removed capabilities                                                                                                                                                                                                                                                                                                                                                                                                            |
| `webhook: containerSecurityContext: runAsNonRoot:`                           | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Indicates that the container must run as a non-root user. If true, the Kubelet will validate the image at runtime to ensure that it does not run as UID 0 (root) and fail to start the container if it does. If unset or false, no such validation will be performed. May also be set in PodSecurityContext.  If set in both SecurityContext and PodSecurityContext, the value specified in SecurityContext takes precedence.   |
| `webhook: containerSecurityContext: readOnlyRootFilesystem:`                 | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Whether this container has a read-only root filesystem. Default is false. Note that this field cannot be set when spec.os.name is windows.                                                                                                                                                                                                                                                                                      |
| `webhook: containerSecurityContext: allowPrivilegeEscalation:`               | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | AllowPrivilegeEscalation controls whether a process can gain more privileges than its parent process. This bool directly controls if the no_new_privs flag will be set on the container process. AllowPrivilegeEscalation is true always when the container is: 1) run as Privileged 2) has CAP_SYS_ADMIN Note that this field cannot be set when spec.os.name is windows.                                                      |
| `webhook: enableServiceLinks:`                                               | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether information about services should be injected into pod's environment variables, matching the syntax of Docker links.                                                                                                                                                                                                                                                                                          |
| `webhook: image: repository:`                                                | `string`       | `"quay.io/jetstack/cert-manager-webhook"`                                                                                                                                                                                                                                                                                                                       | Repository is the address of a container registry repository. An image repository is made up of slash-separated name components, optionally prefixed by a registry hostname and port in the format [HOST[:PORT_NUMBER]/]PATH.                                                                                                                                                                                                   |
| `webhook: image: tag:`                                                       | `string`       | `"v1.13.2"`                                                                                                                                                                                                                                                                                                                                                     | Tag identifies an image in the repository. A tag name may contain lowercase and uppercase characters, digits, underscores, periods and dashes. A tag name may not start with a period or a dash and may contain a maximum of 128 characters.                                                                                                                                                                                    |
| `webhook: image: digest:`                                                    | `string`       | `"sha256:0a9470447ebf1d3ff1c172e19268be12dc26125ff83320d456f6826c677c0ed2"`                                                                                                                                                                                                                                                                                     | Digest uniquely and immutably identifies an image in the repository. Spec: https://github.com/opencontainers/image-spec/blob/main/descriptor.md#digests.                                                                                                                                                                                                                                                                        |
| `webhook: image: pullPolicy:`                                                | `string`       | `"IfNotPresent"`                                                                                                                                                                                                                                                                                                                                                | PullPolicy defines the pull policy for the image. By default, it is set to IfNotPresent.                                                                                                                                                                                                                                                                                                                                        |
| `webhook: podDisruptionBudget: enabled:`                                     | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `webhook: podDisruptionBudget: minAvailable:`                                | `(int|string)` | `1`                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `webhook: replicas:`                                                         | `int`          | `1`                                                                                                                                                                                                                                                                                                                                                             | is the number of desired replicas.                                                                                                                                                                                                                                                                                                                                                                                              |
| `webhook: securityContext: runAsNonRoot:`                                    | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `webhook: securityContext: seccompProfile: type:`                            | `string`       | `"RuntimeDefault"`                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `webhook: serviceAccount: automountServiceAccountToken:`                     | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `webhook: service: type:`                                                    | `string`       | `"ClusterIP"`                                                                                                                                                                                                                                                                                                                                                   | is the type of the service.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `webhook: volumeMounts:`                                                     | `list`         | `[{"mountPath": "/var/run/secrets/kubernetes.io/serviceaccount","name": "serviceaccount-token","readOnly":true}]`                                                                                                                                                                                                                                               | is the volume mounts for the container.                                                                                                                                                                                                                                                                                                                                                                                         |
| `webhook: volumes:`                                                          | `list`         | `[{"name": "serviceaccount-token","projected":{"defaultMode":444,"sources":[{"serviceAccountToken":{"expirationSeconds":3607,"path": "token"}},{"configMap":{"name": "kube-root-ca.crt","items":[{"key": "ca.crt","path": "ca.crt"}]}},{"downwardAPI":{"items":[{"path": "namespace","fieldRef":{"apiVersion": "v1","fieldPath": "metadata.namespace"}}]}}]}}]` | is the volumes for the pod.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `caInjector: automountServiceAccountToken:`                                  | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `caInjector: containerSecurityContext: capabilities: drop:`                  | `list`         | `["ALL"]`                                                                                                                                                                                                                                                                                                                                                       | Removed capabilities                                                                                                                                                                                                                                                                                                                                                                                                            |
| `caInjector: containerSecurityContext: runAsNonRoot:`                        | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Indicates that the container must run as a non-root user. If true, the Kubelet will validate the image at runtime to ensure that it does not run as UID 0 (root) and fail to start the container if it does. If unset or false, no such validation will be performed. May also be set in PodSecurityContext.  If set in both SecurityContext and PodSecurityContext, the value specified in SecurityContext takes precedence.   |
| `caInjector: containerSecurityContext: readOnlyRootFilesystem:`              | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Whether this container has a read-only root filesystem. Default is false. Note that this field cannot be set when spec.os.name is windows.                                                                                                                                                                                                                                                                                      |
| `caInjector: containerSecurityContext: allowPrivilegeEscalation:`            | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | AllowPrivilegeEscalation controls whether a process can gain more privileges than its parent process. This bool directly controls if the no_new_privs flag will be set on the container process. AllowPrivilegeEscalation is true always when the container is: 1) run as Privileged 2) has CAP_SYS_ADMIN Note that this field cannot be set when spec.os.name is windows.                                                      |
| `caInjector: enableServiceLinks:`                                            | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether information about services should be injected into pod's environment variables, matching the syntax of Docker links.                                                                                                                                                                                                                                                                                          |
| `caInjector: image: repository:`                                             | `string`       | `"quay.io/jetstack/cert-manager-cainjector"`                                                                                                                                                                                                                                                                                                                    | Repository is the address of a container registry repository. An image repository is made up of slash-separated name components, optionally prefixed by a registry hostname and port in the format [HOST[:PORT_NUMBER]/]PATH.                                                                                                                                                                                                   |
| `caInjector: image: tag:`                                                    | `string`       | `"v1.13.2"`                                                                                                                                                                                                                                                                                                                                                     | Tag identifies an image in the repository. A tag name may contain lowercase and uppercase characters, digits, underscores, periods and dashes. A tag name may not start with a period or a dash and may contain a maximum of 128 characters.                                                                                                                                                                                    |
| `caInjector: image: digest:`                                                 | `string`       | `"sha256:858fee0c4af069d0e87c08fd0943f0091434e05f945d222875fc1f3d36c41616"`                                                                                                                                                                                                                                                                                     | Digest uniquely and immutably identifies an image in the repository. Spec: https://github.com/opencontainers/image-spec/blob/main/descriptor.md#digests.                                                                                                                                                                                                                                                                        |
| `caInjector: image: pullPolicy:`                                             | `string`       | `"IfNotPresent"`                                                                                                                                                                                                                                                                                                                                                | PullPolicy defines the pull policy for the image. By default, it is set to IfNotPresent.                                                                                                                                                                                                                                                                                                                                        |
| `caInjector: podDisruptionBudget: enabled:`                                  | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `caInjector: podDisruptionBudget: minAvailable:`                             | `(int|string)` | `1`                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `caInjector: replicas:`                                                      | `int`          | `1`                                                                                                                                                                                                                                                                                                                                                             | is the number of desired replicas.                                                                                                                                                                                                                                                                                                                                                                                              |
| `caInjector: securityContext: runAsNonRoot:`                                 | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `caInjector: securityContext: seccompProfile: type:`                         | `string`       | `"RuntimeDefault"`                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `caInjector: serviceAccount: automountServiceAccountToken:`                  | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `caInjector: service: type:`                                                 | `string`       | `"ClusterIP"`                                                                                                                                                                                                                                                                                                                                                   | is the type of the service.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `caInjector: volumeMounts:`                                                  | `list`         | `[{"mountPath": "/var/run/secrets/kubernetes.io/serviceaccount","name": "serviceaccount-token","readOnly":true}]`                                                                                                                                                                                                                                               | is the volume mounts for the container.                                                                                                                                                                                                                                                                                                                                                                                         |
| `caInjector: volumes:`                                                       | `list`         | `[{"name": "serviceaccount-token","projected":{"defaultMode":444,"sources":[{"serviceAccountToken":{"expirationSeconds":3607,"path": "token"}},{"configMap":{"name": "kube-root-ca.crt","items":[{"key": "ca.crt","path": "ca.crt"}]}},{"downwardAPI":{"items":[{"path": "namespace","fieldRef":{"apiVersion": "v1","fieldPath": "metadata.namespace"}}]}}]}}]` | is the volumes for the pod.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `acmeSolver: image: repository:`                                             | `string`       | `"quay.io/jetstack/cert-manager-acmesolver"`                                                                                                                                                                                                                                                                                                                    | Repository is the address of a container registry repository. An image repository is made up of slash-separated name components, optionally prefixed by a registry hostname and port in the format [HOST[:PORT_NUMBER]/]PATH.                                                                                                                                                                                                   |
| `acmeSolver: image: tag:`                                                    | `string`       | `"v1.13.2"`                                                                                                                                                                                                                                                                                                                                                     | Tag identifies an image in the repository. A tag name may contain lowercase and uppercase characters, digits, underscores, periods and dashes. A tag name may not start with a period or a dash and may contain a maximum of 128 characters.                                                                                                                                                                                    |
| `acmeSolver: image: digest:`                                                 | `string`       | `"sha256:7057fd605f530ab2198ebdf1cb486818cce20682632be37c90522a09b95271b1"`                                                                                                                                                                                                                                                                                     | Digest uniquely and immutably identifies an image in the repository. Spec: https://github.com/opencontainers/image-spec/blob/main/descriptor.md#digests.                                                                                                                                                                                                                                                                        |
| `acmeSolver: image: pullPolicy:`                                             | `string`       | `"IfNotPresent"`                                                                                                                                                                                                                                                                                                                                                | PullPolicy defines the pull policy for the image. By default, it is set to IfNotPresent.                                                                                                                                                                                                                                                                                                                                        |
| `test: enabled:`                                                             | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Enable startupAPICheck to verify the cert-manager API is available                                                                                                                                                                                                                                                                                                                                                              |
| `test: startupAPICheck: backoffLimit:`                                       | `int`          | `4`                                                                                                                                                                                                                                                                                                                                                             | is the number of retries before considering a Job as failed.                                                                                                                                                                                                                                                                                                                                                                    |
| `test: startupAPICheck: automountServiceAccountToken:`                       | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `test: startupAPICheck: containerSecurityContext: capabilities: drop:`       | `list`         | `["ALL"]`                                                                                                                                                                                                                                                                                                                                                       | Removed capabilities                                                                                                                                                                                                                                                                                                                                                                                                            |
| `test: startupAPICheck: containerSecurityContext: runAsNonRoot:`             | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Indicates that the container must run as a non-root user. If true, the Kubelet will validate the image at runtime to ensure that it does not run as UID 0 (root) and fail to start the container if it does. If unset or false, no such validation will be performed. May also be set in PodSecurityContext.  If set in both SecurityContext and PodSecurityContext, the value specified in SecurityContext takes precedence.   |
| `test: startupAPICheck: containerSecurityContext: readOnlyRootFilesystem:`   | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          | Whether this container has a read-only root filesystem. Default is false. Note that this field cannot be set when spec.os.name is windows.                                                                                                                                                                                                                                                                                      |
| `test: startupAPICheck: containerSecurityContext: allowPrivilegeEscalation:` | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | AllowPrivilegeEscalation controls whether a process can gain more privileges than its parent process. This bool directly controls if the no_new_privs flag will be set on the container process. AllowPrivilegeEscalation is true always when the container is: 1) run as Privileged 2) has CAP_SYS_ADMIN Note that this field cannot be set when spec.os.name is windows.                                                      |
| `test: startupAPICheck: enableServiceLinks:`                                 | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether information about services should be injected into pod's environment variables, matching the syntax of Docker links.                                                                                                                                                                                                                                                                                          |
| `test: startupAPICheck: image: repository:`                                  | `string`       | `"quay.io/jetstack/cert-manager-ctl"`                                                                                                                                                                                                                                                                                                                           | Repository is the address of a container registry repository. An image repository is made up of slash-separated name components, optionally prefixed by a registry hostname and port in the format [HOST[:PORT_NUMBER]/]PATH.                                                                                                                                                                                                   |
| `test: startupAPICheck: image: tag:`                                         | `string`       | `"v1.13.2"`                                                                                                                                                                                                                                                                                                                                                     | Tag identifies an image in the repository. A tag name may contain lowercase and uppercase characters, digits, underscores, periods and dashes. A tag name may not start with a period or a dash and may contain a maximum of 128 characters.                                                                                                                                                                                    |
| `test: startupAPICheck: image: digest:`                                      | `string`       | `"sha256:4d9fce2c050eaadabedac997d9bd4a003341e9172c3f48fae299d94fa5f03435"`                                                                                                                                                                                                                                                                                     | Digest uniquely and immutably identifies an image in the repository. Spec: https://github.com/opencontainers/image-spec/blob/main/descriptor.md#digests.                                                                                                                                                                                                                                                                        |
| `test: startupAPICheck: image: pullPolicy:`                                  | `string`       | `"IfNotPresent"`                                                                                                                                                                                                                                                                                                                                                | PullPolicy defines the pull policy for the image. By default, it is set to IfNotPresent.                                                                                                                                                                                                                                                                                                                                        |
| `test: startupAPICheck: timeout:`                                            | `string`       | `"1m"`                                                                                                                                                                                                                                                                                                                                                          | Timeout for 'kubectl check api' command                                                                                                                                                                                                                                                                                                                                                                                         |
| `test: startupAPICheck: podDisruptionBudget: enabled:`                       | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `test: startupAPICheck: podDisruptionBudget: minAvailable:`                  | `(int|string)` | `1`                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `test: startupAPICheck: replicas:`                                           | `int`          | `1`                                                                                                                                                                                                                                                                                                                                                             | is the number of desired replicas.                                                                                                                                                                                                                                                                                                                                                                                              |
| `test: startupAPICheck: securityContext: runAsNonRoot:`                      | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `test: startupAPICheck: securityContext: seccompProfile: type:`              | `string`       | `"RuntimeDefault"`                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `test: startupAPICheck: serviceAccount: automountServiceAccountToken:`       | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                         | indicates whether a service account token should be automatically mounted.                                                                                                                                                                                                                                                                                                                                                      |
| `test: startupAPICheck: service: type:`                                      | `string`       | `"ClusterIP"`                                                                                                                                                                                                                                                                                                                                                   | is the type of the service.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `test: startupAPICheck: volumeMounts:`                                       | `list`         | `[{"mountPath": "/var/run/secrets/kubernetes.io/serviceaccount","name": "serviceaccount-token","readOnly":true}]`                                                                                                                                                                                                                                               | is the volume mounts for the container.                                                                                                                                                                                                                                                                                                                                                                                         |
| `test: startupAPICheck: volumes:`                                            | `list`         | `[{"name": "serviceaccount-token","projected":{"defaultMode":444,"sources":[{"serviceAccountToken":{"expirationSeconds":3607,"path": "token"}},{"configMap":{"name": "kube-root-ca.crt","items":[{"key": "ca.crt","path": "ca.crt"}]}},{"downwardAPI":{"items":[{"path": "namespace","fieldRef":{"apiVersion": "v1","fieldPath": "metadata.namespace"}}]}}]}}]` | is the volumes for the pod.                                                                                                                                                                                                                                                                                                                                                                                                     |

### Recommended values

By default this module is configured for a production deployment and should comply with the restricted
[Kubernetes pod security standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/), any changes
would potentially result in a deployment that doesn't meet these standards.

| Testing | Table | Should | Stay |
|---------|-------|--------|------|
| Testing | Table | Should | Stay |
| Testing | Table | Should | Stay |
| Testing | Table | Should | Stay |
| Testing | Table | Should | Stay |

```cue
values: {
    logLevel: 4

    // There are two ways to setup high availability one is to set the replicas in each controller section, another is
    // this shortcut, which defaults to the recommended settings defined here: https://cert-manager.io/docs/installation/best-practice/#high-availability
    highAvailability: enabled: true
    // Setting the above true will ignore controller: replicas: etc and use the below
    // highAvailanility: controllerReplicas: 2
    // highAvailanility: webhookReplicas:    3
    // highAvailanility: caInjectorReplicas: 2

    // By default ServiceAccount tokens are not mounted, instead a Volume and VolumeMount are setup to add the
    // ServiceAccount token to the Pod, so here we're reversing that
    controller: automountServiceAccountToken: true
    controller: serviceAccount: automountServiceAccountToken: true
    controller: volumes: []
    controller: volumeMounts: []

    caInjector: automountServiceAccountToken: true
    caInjector: serviceAccount: automountServiceAccountToken: true
    caInjector: volumes: []
    caInjector: volumeMounts: []

    webhook: automountServiceAccountToken: true
    webhook: serviceAccount: automountServiceAccountToken: true
    webhook: volumes: []
    webhook: volumeMounts: []

    test: startupAPICheck: automountServiceAccountToken: true
    test: startupAPICheck: serviceAccount: automountServiceAccountToken: true
    test: startupAPICheck: volumes: []
    test: startupAPICheck: volumeMounts: []
}
```
